{
    "version": "https://jsonfeed.org/version/1",
    "title": "null • All posts by \"src漏洞挖掘\" category",
    "description": "",
    "home_page_url": "https://3S-sec.github.io",
    "items": [
        {
            "id": "https://3s-sec.github.io/2023/03/24/appid%E4%B8%8Esecert%E6%B3%84%E9%9C%B2%E6%B7%B1%E5%BA%A6%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/",
            "url": "https://3s-sec.github.io/2023/03/24/appid%E4%B8%8Esecert%E6%B3%84%E9%9C%B2%E6%B7%B1%E5%BA%A6%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/",
            "title": "appid与secert泄露深度利用方法",
            "date_published": "2023-03-24T04:26:23.000Z",
            "content_html": "<h2 id=\"漏洞介绍\"><a class=\"markdownIt-Anchor\" href=\"#漏洞介绍\">#</a> 漏洞介绍</h2>\n<p>今天分享一下 appid 与 secert 泄露得利用方法，也不能算是漏洞吧，其实就是只要我们拿到这个对应的 appid 与 secert 就可以完成一些对小程序的接管，本质在于我们是否可以获取到这个信息。</p>\n<p>首先介绍一下 appid 和 secert 得作用，这里可以查看一下官方文档</p>\n<p><img data-src=\".%5Cimage-20230324124234955.png\" alt=\"image-20230324124234955\"></p>\n<ul>\n<li>appid：小程序标识</li>\n<li>secret：密钥</li>\n</ul>\n<h2 id=\"获取方法\"><a class=\"markdownIt-Anchor\" href=\"#获取方法\">#</a> 获取方法</h2>\n<p>这里我们了解了 appid、secret 以后可以具体看一下，这两个东西我们从哪来获取。</p>\n<h3 id=\"页面报错\"><a class=\"markdownIt-Anchor\" href=\"#页面报错\">#</a> 页面报错</h3>\n<p>首先可以通过页面报错得方式，比如我们胡乱的构造一些参数，路径加一些斜杠、特殊字符等能使页面报错得方法，有可能就会泄露 secret。</p>\n<p><img data-src=\".%5Cimage-20230324124919103.png\" alt=\"image-20230324124919103\"></p>\n<h3 id=\"反编译\"><a class=\"markdownIt-Anchor\" href=\"#反编译\">#</a> 反编译</h3>\n<p>反编译需要使用模拟器提取 wxapkg 文件进行反编译，这里不过多阐述，网上找一些工具反编译之后全局搜索就可以了。</p>\n<h3 id=\"github\"><a class=\"markdownIt-Anchor\" href=\"#github\">#</a> github</h3>\n<p>在 github 中也可以发现一些泄露的 appid、secert，可以尝试寻找一下，搜索你要挖掘的域名加上关键字就可以搜索</p>\n<p><img data-src=\".%5Cappid%E4%B8%8Esecert%E6%B3%84%E9%9C%B2%E6%B7%B1%E5%BA%A6%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%5Cimage-20230324125607389.png\" alt=\"image-20230324125607389\"></p>\n<h2 id=\"利用方式\"><a class=\"markdownIt-Anchor\" href=\"#利用方式\">#</a> 利用方式</h2>\n<p>当我们拿到了 appid、secert 这时该怎么利用呢，这里引出 access_token，看一下具体的官方文档</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L2ZyYW1ld29yay9zZXJ2ZXItYWJpbGl0eS9iYWNrZW5kLWFwaS5odG1s\">https://developers.weixin.qq.com/miniprogram/dev/framework/server-ability/backend-api.html</span></p>\n<p><img data-src=\".%5Cappid%E4%B8%8Esecert%E6%B3%84%E9%9C%B2%E6%B7%B1%E5%BA%A6%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%5Cimage-20230324125833424.png\" alt=\"image-20230324125833424\"></p>\n<p>这里可以看到是全局唯一后台接口调用凭据，接下来看一下获取方式。</p>\n<h3 id=\"获取access_token\"><a class=\"markdownIt-Anchor\" href=\"#获取access_token\">#</a> 获取 access_token</h3>\n<p>接口文档这里有写，获取 access_token 信息得接口是 getAccessToken，具体得功能如下：</p>\n<ul>\n<li>获取小程序全局唯一后台接口调用凭据，token 有效期为 7200s，开发者需要进行妥善保存。</li>\n<li>如使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L3d4Y2xvdWQvYmFzaXMvZ2V0dGluZy1zdGFydGVkLmh0bWw=\">云开发</span>，可通过<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L3d4Y2xvdWQvZ3VpZGUvb3BlbmFwaS9vcGVuYXBpLmh0bWw=\">云调用</span>免维护 access_token 调用。</li>\n<li>如使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L3d4Y2xvdWRydW4vc3JjL2Jhc2ljL2ludHJvLmh0bWw=\">云托管</span>，也可以通过<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L3d4Y2xvdWRydW4vc3JjL2d1aWRlL3dlaXhpbi9vcGVuLmh0bWw=\">微信令牌 / 开放接口服务</span>免维护 access_token 调用。</li>\n</ul>\n<p>具体调用参数</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">属性</th>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">必填</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">grant_type</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">是</td>\n<td style=\"text-align:left\">填写 client_credential</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">appid</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">是</td>\n<td style=\"text-align:left\">小程序唯一凭证，即 AppID，可在「微信公众平台 - 设置 - 开发设置」页中获得。（需要已经成为开发者，且帐号没有异常状态）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">secret</td>\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">是</td>\n<td style=\"text-align:left\">小程序唯一凭证密钥，即 AppSecret，获取方式同 appid</td>\n</tr>\n</tbody>\n</table>\n<p>最终实现的进行利用得 poc 如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET https<span class=\"punctuation\">:</span><span class=\"comment\">//api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</span></span><br></pre></td></tr></table></figure>\n<p>此时服务器会返回一段 json 数据，其中携带 access_token</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">&quot;access_token&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;ACCESS_TOKEN&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;expires_in&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">7200</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"access_token深度利用\"><a class=\"markdownIt-Anchor\" href=\"#access_token深度利用\">#</a> access_token 深度利用</h3>\n<p>之后设计到得深度利用有很多，这里可以查阅具体的官方文档，当我们获取到 appid、secert 就可以接管该小程序</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L09wZW5BcGlEb2MvZ2V0dGluZ19zdGFydGVkL3NpZ25hdHVyZS12ZXJpZnkuaHRtbA==\">https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/getting_started/signature-verify.html</span></p>\n<p><img data-src=\".%5Cappid%E4%B8%8Esecert%E6%B3%84%E9%9C%B2%E6%B7%B1%E5%BA%A6%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%5Cimage-20230324130533604.png\" alt=\"image-20230324130533604\"></p>\n<p>这里举例，比如通过该小程序下发消息，可以使用如下接口</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L09wZW5BcGlEb2MvbXAtbWVzc2FnZS1tYW5hZ2VtZW50L3VuaWZvcm0tbWVzc2FnZS9zZW5kVW5pZm9ybU1lc3NhZ2UuaHRtbA==\">https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-message-management/uniform-message/sendUniformMessage.html</span></p>\n<p>通过如下接口进行访问</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST https://api.weixin.qq.com/cgi-bin/message/wxopen/template/uniform_send?access_token=ACCESS_TOKEN</span><br></pre></td></tr></table></figure>\n<p>参数这里 api 文档也定义出来了，可以看到只需要填入身份验证 access_token 即可调用该接口进行消息得发送。</p>\n<p><img data-src=\".%5Cappid%E4%B8%8Esecert%E6%B3%84%E9%9C%B2%E6%B7%B1%E5%BA%A6%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%5Cimage-20230324130815181.png\" alt=\"image-20230324130815181\"></p>\n<p>如下是数据实例，替换信息即可进行接口调用</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;touser&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;OPENID&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;weapp_template_msg&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;template_id&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;TEMPLATE_ID&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;page&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;page/page/index&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;form_id&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;FORMID&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;data&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword1&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;339208499&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword2&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;2015年01月05日 12:30&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword3&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;腾讯微信总部&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword4&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;广州市海珠区新港中路397号&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;emphasis_keyword&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;keyword1.DATA&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mp_template_msg&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;appid&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;APPID &quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;template_id&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;TEMPLATE_ID&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;http://weixin.qq.com/download&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;miniprogram&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;appid&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xiaochengxuappid12345&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;pagepath&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;index?foo=bar&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;data&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;first&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;恭喜你购买成功！&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;color&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;#173177&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword1&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;巧克力&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;color&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;#173177&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword2&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;39.8元&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;color&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;#173177&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword3&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;2014年9月22日&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;color&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;#173177&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;remark&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;value&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;欢迎再次购买！&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;color&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;#173177&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span> </span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "web",
                "src"
            ]
        }
    ]
}